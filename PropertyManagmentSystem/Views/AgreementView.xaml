<UserControl x:Class="PropertyManagmentSystem.Views.AgreementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:conv="clr-namespace:PropertyManagmentSystem.Converters"
             mc:Ignorable="d"
             d:DesignHeight="802.417" d:DesignWidth="800">

    <UserControl.Resources>
        <conv:EmptyStringToGrayConverter x:Key="EmptyStringToGrayConverter"/>
    </UserControl.Resources>

    <StackPanel>
        <TextBox
                 Text="{Binding RegistrationNumber}" Margin="0,4"
                 Foreground="{Binding RegistrationNumber, Converter={StaticResource EmptyStringToGrayConverter}}"
                 />

        <Grid Margin="8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Margin="6">
                <TextBlock Text="Все договоры" FontWeight="Bold" FontSize="14" Margin="0,0,0,6"/>
                <ListBox ItemsSource="{Binding Agreements}" SelectedItem="{Binding SelectedAgreement}" DisplayMemberPath="RegistrationNumber" Height="220"/>
                <TextBlock Text="Активные договоры" FontWeight="Bold" Margin="0,8,0,4"/>
                <ListBox ItemsSource="{Binding ActiveAgreements}" DisplayMemberPath="RegistrationNumber" Height="120"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Margin="6">
                <!-- Selected agreement details -->
                <GroupBox Header="Детали договора" Margin="0,0,0,8">
                    <StackPanel Margin="8">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Рег. номер: " FontWeight="Bold" Width="110"/>
                            <TextBlock Text="{Binding SelectedAgreement.RegistrationNumber}"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Арендатор: " FontWeight="Bold" Width="110"/>
                            <TextBlock Text="{Binding SelectedAgreementContractorName}"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Период: " FontWeight="Bold" Width="110"/>
                            <TextBlock Text="{Binding SelectedAgreement.StartDate, StringFormat={}{0:dd.MM.yyyy}}"/>
                            <TextBlock Text=" — " Margin="6,0"/>
                            <TextBlock Text="{Binding SelectedAgreement.EndDate, StringFormat={}{0:dd.MM.yyyy}}"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Статус: " FontWeight="Bold" Width="110"/>
                            <TextBlock Text="{Binding SelectedAgreement.Status}"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Месячная аренда: " FontWeight="Bold" Width="110"/>
                            <TextBlock Text="{Binding SelectedAgreement.TotalMonthlyRent, StringFormat={}{0:C}}"/>
                        </StackPanel>

                        <TextBlock Text="Помещения в договоре:" FontWeight="Bold" Margin="0,8,0,4"/>
                        <DataGrid ItemsSource="{Binding SelectedAgreementRooms}" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True" Height="140">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Код" Binding="{Binding RoomId}" Width="60"/>
                                <DataGridTextColumn Header="Номер" Binding="{Binding RoomNumber}" Width="100"/>
                                <DataGridTextColumn Header="Цель" Binding="{Binding Purpose}" Width="120"/>
                                <DataGridTextColumn Header="Сумма" Binding="{Binding RentAmount, StringFormat={}{0:C}}" Width="120"/>
                                <DataGridTextColumn Header="По" Binding="{Binding RentUntil, StringFormat={}{0:dd.MM.yyyy}}" Width="120"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Создать договор" Margin="0,0,0,8">
                    <StackPanel Margin="8">
                        <TextBox Text="{Binding RegistrationNumber}" Margin="0,4">
                            <TextBox.Style>
                                <Style TargetType="TextBox">
                                    <Setter Property="Foreground" Value="Black"/>
                                    <Style.Triggers>
                                        <Trigger Property="Text" Value="">
                                            <Setter Property="Foreground" Value="Gray"/>
                                        </Trigger>
                                        <Trigger Property="IsKeyboardFocused" Value="True">
                                            <Setter Property="Foreground" Value="Black"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBox.Style>
                        </TextBox>
                        <StackPanel Orientation="Horizontal" Margin="0,4">
                            <StackPanel>
                                <TextBlock Text="Дата начала"/>
                                <DatePicker SelectedDate="{Binding StartDate}"/>
                            </StackPanel>
                            <StackPanel Margin="12,0,0,0">
                                <TextBlock Text="Дата окончания"/>
                                <DatePicker SelectedDate="{Binding EndDate}"/>
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,4">
                            <TextBlock Text="Платежная частота:" VerticalAlignment="Center" Margin="0,6"/>
                            <ComboBox ItemsSource="{Binding PaymentFrequencies}" SelectedItem="{Binding PaymentFrequency}" Margin="6,4" Width="160"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,4">
                            <TextBlock Text="Арендатор:" VerticalAlignment="Center" Margin="0,6"/>
                            <ComboBox ItemsSource="{Binding Contractors}" SelectedItem="{Binding SelectedContractorForNewAgreement}" DisplayMemberPath="DisplayName" Width="220" Margin="6,4"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,8">
                            <Button Content="Создать" Command="{Binding CreateAgreementCommand}" Width="120" Margin="0,0,6,0"/>
                            <Button Content="Подписать" Command="{Binding SignAgreementCommand}" Width="120"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Добавить арендуемое помещение">
                    <StackPanel Margin="8">
                        <StackPanel Orientation="Horizontal" Margin="0,4">
                            <TextBlock Text="Помещение:" VerticalAlignment="Center"/>
                            <ComboBox ItemsSource="{Binding AvailableRooms}"
                                      SelectedItem="{Binding SelectedRoomForRent}"
                                      Width="210" Margin="8,0,0,0">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding RoomNumber}" />
                                            <TextBlock Text=" — " Margin="6,0,0,0"/>
                                            <TextBlock Text="{Binding BuildingAddress}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <TextBlock Text="Цель:" VerticalAlignment="Center" Margin="12,0,0,0"/>
                            <ComboBox ItemsSource="{Binding RoomPurposes}" SelectedItem="{Binding RoomPurpose}" Width="140" Margin="8,0,0,0"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,4">
                            <TextBlock Text="Сумма:" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding RentAmount}" Width="100" Margin="8,0,0,0"/>
                            <TextBlock Text="По:" VerticalAlignment="Center" Margin="12,0,0,0"/>
                            <DatePicker SelectedDate="{Binding RentUntil}" Margin="8,0,0,0"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,8">
                            <Button Content="Добавить помещение" Command="{Binding AddRentedItemCommand}" Width="160" Margin="0,0,6,0"/>
                            <Button Content="Рассчитать штраф" Command="{Binding CalculatePenaltyCommand}" Width="160"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </Grid>
    </StackPanel>
</UserControl>